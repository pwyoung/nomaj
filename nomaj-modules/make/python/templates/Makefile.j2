# Makefile generated by Nomaj
# Project: {{ project_namespace }}
# Config: {{ cfg }}
{% if 'vagrant' in cfg %}
    {% set vagrant=True %}
{% else %}
    {% set vagrant=False %}
{% endif %}
# Vagrant: {{ vagrant }}

{% if 'ansible' in cfg %}
    {% set ansible=True %}
{% else %}
    {% set ansible=False %}
{% endif %}
# Vagrant: {{ vagrant }}
# Ansible: {{ ansible }}

MAKEFILE_PATH=$(dir $(realpath $(firstword $(MAKEFILE_LIST))))
EXISTING_BUILD_DIR=$(MAKEFILE_PATH)/..
MERGED_CONFIG_FILE=$(MAKEFILE_PATH)/../config.yaml

# Run nomaj but re-use the build_dir and config file that were created
# when "nomaj -m make" was run.
NOMAJ?={{ nomaj_app }}
NOMAJ+=--config-file $(MERGED_CONFIG_FILE)
NOMAJ+=--build-dir $(EXISTING_BUILD_DIR)

.PHONY=all

all:
	$(info MAKE ALL)
{% if vagrant %}
	$(NOMAJ) -m vagrant -x run
{% endif %}
{% if ansible %}
	$(NOMAJ) -m ansible -x run
{% endif %}

clean:
	$(info MAKE CLEAN)
{% if vagrant %}
	$(NOMAJ) -m vagrant -x clean
{% endif %}

